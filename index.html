<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>

		<script src="/lib/easeljs/utils/UID.js" ></script>
		<script src="/lib/easeljs/geom/Matrix2D.js" ></script>
		<script src="/lib/easeljs//events/MouseEvent.js"></script>
		<script src="/lib/easeljs/display/DisplayObject.js" ></script>
		<script src="/lib/easeljs/display/Container.js" ></script>
		<script src="/lib/easeljs/display/Bitmap.js" ></script>
		<script src="/lib/easeljs/display/Graphics.js" ></script>
		<script src="/lib/easeljs/display/Shape.js"></script>
		<script src="/lib/easeljs/display/Stage.js" ></script>
		<script src="/lib/easeljs/utils/Ticker.js" ></script>
		
		
		<!-- Project includes -->
		<script src="/lib/proj/Planet.js" ></script>

	</head>
	<body onload="init();">
		<canvas id="scene" width=800 height=600 style="background:#000;"></canvas>
		<script>

			var canvas = document.getElementById('scene');
			//var ctx = canvas.getContext('2d');
			var WIDTH = canvas.width;
			var HEIGHT = canvas.height;
			var planets=[]; //array to hold planets
			var star = []; //array to hold stars
		
			var sunX = WIDTH / 2;
			var sunY = HEIGHT / 2;
		
			var time;
		
			var stage;
		
			var container;
		
			var instance = this;
		
			// Number of planets added to the Galaxy
			function init() {
				stage = new Stage( canvas );
				stage.autoClear = true;
				container = new Container();
				stage.addChild( container );
			
				addPlanet( 15, 0.7, 100, 0 , "planet_sq1_on" );
				addPlanet( 25, 0.5, 150, 0, "planet_sl1_on" );
				addPlanet( 35, 0.3, 220, 0.7, "terra_color" );
				Ticker.addListener( window, true)
			}
		
			// Saves Planet Object to array
			function addPlanet( radius, velocity , orbit, orbit_adjust,  type ) {
				console.log('--- Add Planet ---');
				var planet = new Planet( radius, velocity, orbit, orbit_adjust , "/img/" + type + ".gif" );
				container.addChild( planet );
			}
			
			
		
			function isCollision(obj1, r1, obj2, r2) {
				var a = r1 + r2;
				var dx = obj1.x - obj2.x;
				var dy = obj1.y - obj2.y;
				return a * a > (dx * dx + dy * dy);
			}
		
		
			function tick() {
				time = new Date().getTime() * 0.002; // 0.002 increment for more speed
				
				//Draws the sun
				var sun_bmp = new Bitmap("/img/sun.png");
				sun_bmp.regX = 70 / 2;
				sun_bmp.regY = 70 / 2;
				sun_bmp.x = sunX;
				sun_bmp.y = sunY;
				stage.addChild( sun_bmp );
				stage.children = stage.children.slice( 0 , 2 );
			
				//ctx.translate( sunX, sunY ); // Sets Sun center point to context
				container.x = sunX;
				container.y = sunY;
			
				// Draws each planet each frame
				var num_planets =container.children.length;
				for ( var i = 0; i < num_planets; i++ ) {
					var current_planet = container.children[i];
					current_planet.draw( canvas.getContext('2d'), true, time  );
					//current_planet.orbit_adjust += 0.001;
					
					
					if ( isCollision( current_planet, current_planet.radius, { x: 0, y: 0 }, 30 ) ) { // object 0,0 is current translate possition
						console.log( 'Sun Collision ' + current_planet.type + ' hits the sun' );
						
					}
					
					for ( var f = 0; f < num_planets; f++ ) {
						if ( f !== i ){
							if ( isCollision( container.children[f], container.children[f].radius, current_planet, current_planet.radius ) ) {
								console.log( 'Planet Collision between ' + container.children[f].type + ' and ' + container.children[i].type );
							}
							
						}
					}
				}
			
				stage.update();
			};
		
		

		</script>
	</body>
</html>