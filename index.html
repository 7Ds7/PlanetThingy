<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
        <link rel="stylesheet" href="css/tickercontrols.css" />

		<script src="lib/easeljs/utils/UID.js" ></script>
		<script src="lib/easeljs/geom/Matrix2D.js" ></script>
		<script src="lib/easeljs/geom/Rectangle.js" ></script>
		<script src="lib/easeljs//events/MouseEvent.js"></script>
		<script src="lib/easeljs/display/DisplayObject.js" ></script>
		<script src="lib/easeljs/display/Container.js" ></script>
		<script src="lib/easeljs/display/Bitmap.js" ></script>
		<script src="lib/easeljs/display/BitmapAnimation.js" ></script>
		<script src="lib/easeljs/display/SpriteSheet.js" ></script>
		<script src="lib/easeljs/display/Graphics.js" ></script>
		<script src="lib/easeljs/display/Shape.js"></script>
		<script src="lib/easeljs/display/Stage.js" ></script>
		<script src="lib/easeljs/utils/Ticker.js" ></script>

		<!-- Project includes -->
		<script src="lib/proj/Sun.js" ></script>
		<script src="lib/proj/Planet.js" ></script>
		<script src="lib/proj/Asteroid.js" ></script>
		<script src="lib/proj/tickercontrols.js" ></script>

	</head>
	<body onload="init();">
		<canvas id="scene" width=800 height=600 style="background:#000;"></canvas>
		<script>

			var canvas = document.getElementById('scene');
			//var ctx = canvas.getContext('2d');
			var WIDTH = canvas.width;
			var HEIGHT = canvas.height;
		
			var sunX = WIDTH / 2;
			var sunY = HEIGHT / 2;
		
			var time;
			var stage;
			var container;
			var instance = this;
			
			var asteroid;
		
			// Number of planets added to the Galaxy
			function init() {
				stage = new Stage( canvas );
				stage.autoClear = true;
				container = new Container();
				stage.addChild( container );
			
				addPlanet( 15, 0.7, 100, 0 , "planet_sq1_on" );
				addPlanet( 25, 0.5, 150, 0, "planet_sl1_on" );
				addPlanet( 35, 0.3, 220, 0.7, "terra_color" );
				
				var sun_bmp = new Sun( sunX, sunY, 70, stage, "img/sun.png");
				stage.addChild( sun_bmp );
				
				
				
				//Translate container origin to sun center point
				container.x = sunX;
				container.y = sunY;
				
				asteroid = new Asteroid( 15, 0.7, 100, 0 , "img/asteroid.png" );
				container.addChild( asteroid );

				Ticker.addListener( window, true)
				TickerControls.init();
			}
		
			// Saves Planet Object to array
			function addPlanet( radius, velocity , orbit, orbit_adjust,  type ) {
				console.log('--- Add Planet ---');
				var planet = new Planet( radius, velocity, orbit, orbit_adjust , "img/" + type + ".gif" );
				container.addChild( planet );
			}
			
			
			
			// Pass 2 objects with x, y and respective radius
			function isCollision(obj1, r1, obj2, r2) {
				var a = r1 + r2;
				var dx = obj1.x - obj2.x;
				var dy = obj1.y - obj2.y;
				return a * a > (dx * dx + dy * dy);
			}
		
			var t = 0;
			function tick() {
				//time = new Date().getTime() * 0.002; // 0.002 increment for more speed
				time = t;
				
				asteroid.draw(  canvas.getContext('2d'), true );
					
				
				var asteroid_danger = asteroid.danger;
				// Draws each planet each frame
				var num_planets =container.children.length;
				for ( var i = 0; i < num_planets; i++ ) {
					var current_planet = container.children[i];
					current_planet.draw( canvas.getContext('2d'), true, time  );
					//current_planet.orbit_adjust += 0.001;
					
					if ( isCollision( current_planet, current_planet.radius, { x: 0, y: 0 }, 30 ) ) { // object 0,0 is current translate possition
						console.log( 'Sun Collision ' + current_planet.type + ' hits the sun' );
					}
					
					
					for ( var f = 0; f < num_planets; f++ ) {
						if ( f !== i ){
							
							
							// Will asteroid collide with planet in a near future ?
							if ( container.children[f].type === "img/asteroid.png" ) {
								var current_asteroid = container.children[f];
								if ( isCollision( current_asteroid,  128, current_planet, current_planet.radius  ) ) {
									current_asteroid.danger = "warn";
									//console.log( 'Planet Collision between ' + current_asteroid.type + ' and ' + container.children[i].type );
								} 	
							}
							
							// Is any container child colliding with one sibiling ?	
							if ( isCollision( container.children[f], container.children[f].radius, current_planet, current_planet.radius ) ) {
								console.log( 'Planet Collision between ' + container.children[f].type + ' and ' + container.children[i].type );
								if ( container.children[f].type == "img/asteroid.png") {
									container.children[f].danger = "hit";
								}
							}
							
						}
					}
				}
			
				stage.update();
				t+= 0.07;
			};
			
		</script>
	</body>
</html>